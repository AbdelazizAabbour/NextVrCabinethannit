import{r,u as B,j as e,L as l}from"./index-DAWVmiiJ.js";import{o as w,p as D,t as z}from"./api--cjS8XQN.js";const E=()=>{const[p,j]=r.useState(null),[L,C]=r.useState(!0),[N,_]=r.useState(null),[h,d]=r.useState("overview"),[g,x]=r.useState(!1),[m,b]=r.useState(null),u=r.useRef(null),f=B();r.useEffect(()=>{const s=async()=>{try{const i=await w();j(i.data)}catch(i){console.error("Error fetching dashboard data:",i);const R=i.response?.data?.error||i.response?.data?.message||"";_("Impossible de charger les données du tableau de bord. "+R),i.response&&i.response.status===401&&f("/connexion")}finally{C(!1)}};s();const a=setInterval(s,3e4);return()=>clearInterval(a)},[f]),r.useEffect(()=>{const s=a=>{u.current&&!u.current.contains(a.target)&&x(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const k=async s=>{try{await D(s),j(a=>({...a,messages:a.messages.map(i=>i.id===s?{...i,reply_read:!0}:i),stats:{...a.stats,unread_replies:Math.max(0,a.stats.unread_replies-1)}}))}catch(a){console.error("Error marking reply as read:",a)}};if(L)return e.jsx("div",{className:"user-dashboard",children:e.jsxs("div",{className:"dashboard-container",style:{textAlign:"center",padding:"100px 0"},children:[e.jsx("div",{className:"spinner",style:{margin:"0 auto 20px"}}),e.jsx("p",{children:"Chargement de votre espace personnel..."})]})});if(N)return e.jsx("div",{className:"user-dashboard",children:e.jsx("div",{className:"dashboard-container",children:e.jsxs("div",{className:"card",style:{textAlign:"center",borderTop:"4px solid var(--primary)",padding:"40px"},children:[e.jsx("h2",{style:{color:"var(--primary)",marginBottom:"20px"},children:"Oups !"}),e.jsx("div",{className:"error-box",style:{background:"#fff1f2",color:"#be123c",padding:"15px",borderRadius:"8px",marginBottom:"20px",border:"1px solid #fda4af"},children:N}),e.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-primary",children:"Réessayer"})]})})});if(!p)return null;const{user:v,appointments:c,messages:t,selections:y,stats:n}=p,o=t.filter(s=>s.admin_reply&&!s.reply_read),M=()=>{switch(h){case"appointments":return e.jsx("div",{className:"data-table-container",children:c.length>0?e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Heure"}),e.jsx("th",{children:"Statut"})]})}),e.jsx("tbody",{children:c.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.service||"N/A"}),e.jsx("td",{children:new Date(s.date).toLocaleDateString("fr-FR")}),e.jsx("td",{children:s.time||"--:--"}),e.jsx("td",{children:e.jsx("span",{className:`status-badge status-${s.status}`,children:s.status==="pending"?"En attente":s.status==="confirmed"?"Confirmé":s.status==="cancelled"?"Annulé":s.status})})]},s.id))})]}):e.jsxs("div",{className:"empty-state",children:[e.jsx("h4",{children:"Aucun rendez-vous trouvé"}),e.jsx(l,{to:"/rendez-vous",className:"btn btn-primary",children:"Prendre rendez-vous"})]})});case"messages":return e.jsx("div",{className:"messages-list-container",children:t.length>0?e.jsx("div",{className:"messages-list",children:t.map(s=>e.jsxs("div",{className:`message-card ${s.admin_reply?"has-reply":""} ${m===s.id?"expanded":""}`,onClick:()=>b(m===s.id?null:s.id),children:[e.jsxs("div",{className:"message-card-header",children:[e.jsxs("div",{className:"message-card-info",children:[e.jsx("h4",{className:"message-subject",children:s.subject}),e.jsx("span",{className:"message-date",children:new Date(s.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})})]}),e.jsxs("div",{className:"message-card-badges",children:[s.admin_reply&&e.jsxs("span",{className:"reply-badge",children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"9 17 4 12 9 7"}),e.jsx("path",{d:"M20 18v-2a4 4 0 0 0-4-4H4"})]}),"Répondu"]}),e.jsx("span",{className:`status-badge ${s.is_read?"status-confirmed":"status-pending"}`,children:s.is_read?"Lu":"Non lu"}),e.jsx("svg",{className:"expand-icon",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"6 9 12 15 18 9"})})]})]}),m===s.id&&e.jsxs("div",{className:"message-card-body animate-fadeInUp",children:[e.jsxs("div",{className:"original-message-block",children:[e.jsxs("div",{className:"block-label",children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})}),"Votre message"]}),e.jsx("p",{children:s.message})]}),s.admin_reply&&e.jsxs("div",{className:"admin-reply-block",children:[e.jsxs("div",{className:"block-label admin-label",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),"Réponse de l'administration"]}),e.jsx("p",{children:s.admin_reply}),e.jsxs("div",{className:"reply-meta",children:[e.jsxs("span",{className:"reply-date",children:["Répondu le ",new Date(s.replied_at).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),!s.reply_read&&e.jsxs("button",{className:"mark-read-btn",onClick:a=>{a.stopPropagation(),k(s.id)},children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}),"Marquer comme lu"]})]})]}),!s.admin_reply&&e.jsxs("div",{className:"waiting-reply-block",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]}),e.jsx("span",{children:"En attente de réponse..."})]})]})]},s.id))}):e.jsxs("div",{className:"empty-state",children:[e.jsx("h4",{children:"Aucun message envoyé"}),e.jsx(l,{to:"/contact",className:"btn btn-primary",children:"Nous contacter"})]})});case"selections":return e.jsx("div",{className:"selections-grid",children:y.length>0?y.map(s=>e.jsxs("div",{className:"selection-card",children:[e.jsx("h4",{children:s.title}),e.jsx("p",{children:s.description}),e.jsxs("div",{className:"card-actions",children:[e.jsx(l,{to:"/services",className:"btn-text",children:"Détails"}),e.jsx("button",{onClick:async()=>{await z(s.id);const a=await w();j(a.data)},className:"btn btn-secondary btn-sm",children:"Retirer"})]})]},s.id)):e.jsxs("div",{className:"empty-state",style:{gridColumn:"1 / -1"},children:[e.jsx("h4",{children:"Vous n'avez pas encore de services sélectionnés"}),e.jsx(l,{to:"/services",className:"btn btn-primary",children:"Explorer les services"})]})});default:return e.jsxs("div",{className:"overview-content",children:[e.jsxs("div",{className:"welcome-section",children:[e.jsxs("h3",{children:["Bienvenue sur votre espace, ",v.name," !"]}),e.jsx("p",{children:"Retrouvez ici l'historique de vos rendez-vous, vos messages et vos services préférés."})]}),e.jsxs("div",{className:"overview-grid",children:[e.jsxs("div",{className:"overview-card",children:[e.jsxs("div",{className:"overview-card-header",children:[e.jsx("h4",{children:"Prochain Rendez-vous"}),e.jsx(l,{to:"#",onClick:()=>d("appointments"),className:"view-all",children:"Tout voir"})]}),e.jsx("div",{className:"overview-card-body",children:c.length>0?e.jsxs("div",{className:"featured-item",children:[e.jsx("div",{className:"item-main",children:c[0].service}),e.jsxs("div",{className:"item-sub",children:[new Date(c[0].date).toLocaleDateString("fr-FR")," à ",c[0].time]}),e.jsx("span",{className:`status-badge status-${c[0].status}`,children:c[0].status==="pending"?"En attente":"Confirmé"})]}):e.jsx("p",{className:"empty-text",children:"Aucun rendez-vous à venir."})})]}),e.jsxs("div",{className:"overview-card",children:[e.jsxs("div",{className:"overview-card-header",children:[e.jsx("h4",{children:"Dernier Message"}),e.jsx(l,{to:"#",onClick:()=>d("messages"),className:"view-all",children:"Tout voir"})]}),e.jsx("div",{className:"overview-card-body",children:t.length>0?e.jsxs("div",{className:"featured-item",children:[e.jsx("div",{className:"item-main",children:t[0].subject}),e.jsx("div",{className:"item-sub text-truncate",style:{maxWidth:"200px"},children:t[0].message}),t[0].admin_reply&&e.jsxs("div",{className:"overview-reply-preview",children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"9 17 4 12 9 7"}),e.jsx("path",{d:"M20 18v-2a4 4 0 0 0-4-4H4"})]}),e.jsx("span",{className:"text-truncate",children:t[0].admin_reply})]}),e.jsx("div",{className:"item-date",children:new Date(t[0].created_at).toLocaleDateString("fr-FR")})]}):e.jsx("p",{className:"empty-text",children:"Aucun message envoyé."})})]})]}),e.jsxs("div",{className:"quick-actions-bar",children:[e.jsx("h4",{children:"Actions Rapides"}),e.jsxs("div",{className:"action-buttons",children:[e.jsx(l,{to:"/rendez-vous",className:"btn btn-primary btn-sm",children:"Nouveau Rendez-vous"}),e.jsx(l,{to:"/services",className:"btn btn-secondary btn-sm",children:"Explorer les Services"}),e.jsx(l,{to:"/contact",className:"btn btn-white btn-sm",children:"Nous Contacter"})]})]})]})}};return e.jsx("div",{className:"user-dashboard animate-fadeInUp",children:e.jsxs("div",{className:"dashboard-container",children:[e.jsxs("div",{className:"dashboard-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Mon Tableau de Bord"}),e.jsxs("p",{children:["Espace patient de ",v.name]})]}),e.jsxs("div",{className:"header-actions",children:[e.jsxs("div",{className:"notification-wrapper",ref:u,children:[e.jsxs("button",{className:"notification-bell-btn",onClick:()=>x(!g),title:"Notifications",children:[e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),n.unread_replies>0&&e.jsx("span",{className:"notification-badge",children:n.unread_replies}),n.unread_replies>0&&e.jsx("span",{className:"bell-pulse"})]}),g&&e.jsxs("div",{className:"notifications-dropdown animate-fadeInUp",children:[e.jsxs("div",{className:"notifications-header",children:[e.jsx("h4",{children:"Notifications"}),o.length>0&&e.jsxs("span",{className:"notif-count",children:[o.length," nouvelle",o.length>1?"s":""]})]}),e.jsx("div",{className:"notifications-list",children:o.length>0?o.map(s=>e.jsxs("div",{className:"notification-item unread",children:[e.jsx("div",{className:"notif-icon",children:e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"9 17 4 12 9 7"}),e.jsx("path",{d:"M20 18v-2a4 4 0 0 0-4-4H4"})]})}),e.jsxs("div",{className:"notif-content",children:[e.jsxs("p",{className:"notif-title",children:['Nouvelle réponse à "',e.jsx("strong",{children:s.subject}),'"']}),e.jsxs("p",{className:"notif-preview",children:[s.admin_reply.substring(0,80),s.admin_reply.length>80?"...":""]}),e.jsx("span",{className:"notif-time",children:new Date(s.replied_at).toLocaleDateString("fr-FR",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"notif-actions",children:[e.jsx("button",{className:"notif-read-btn",onClick:a=>{a.stopPropagation(),k(s.id)},title:"Marquer comme lu",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("button",{className:"notif-view-btn",onClick:a=>{a.stopPropagation(),d("messages"),b(s.id),x(!1)},title:"Voir le message",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})})]})]},s.id)):e.jsxs("div",{className:"notif-empty",children:[e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),e.jsx("p",{children:"Aucune nouvelle notification"})]})}),o.length>0&&e.jsx("div",{className:"notifications-footer",children:e.jsx("button",{className:"view-all-btn",onClick:()=>{d("messages"),x(!1)},children:"Voir tous les messages"})})]})]}),v.auth_provider==="google"&&e.jsxs("div",{className:"google-badge-dashboard",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",style:{marginRight:"8px"},children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Authentifié avec Google"]})]})]}),e.jsxs("div",{className:"dashboard-stats",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon icon-blue",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"Rendez-vous"}),e.jsx("div",{className:"stat-value",children:n.total_appointments})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon icon-green",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"Messages"}),e.jsx("div",{className:"stat-value",children:n.total_messages})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon icon-purple",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"Sélections"}),e.jsx("div",{className:"stat-value",children:n.total_selections})]})]}),n.unread_replies>0&&e.jsxs("div",{className:"stat-card stat-card-highlight",children:[e.jsx("div",{className:"stat-icon icon-rose",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]})}),e.jsxs("div",{className:"stat-info",children:[e.jsx("h3",{children:"Réponses non lues"}),e.jsx("div",{className:"stat-value",children:n.unread_replies})]})]})]}),e.jsxs("div",{className:"dashboard-tabs",children:[e.jsx("button",{className:`tab-btn ${h==="overview"?"active":""}`,onClick:()=>d("overview"),children:"Aperçu"}),e.jsx("button",{className:`tab-btn ${h==="appointments"?"active":""}`,onClick:()=>d("appointments"),children:"Mes Rendez-vous"}),e.jsxs("button",{className:`tab-btn ${h==="messages"?"active":""}`,onClick:()=>d("messages"),children:["Mes Messages",n.unread_replies>0&&e.jsx("span",{className:"tab-badge",children:n.unread_replies})]}),e.jsx("button",{className:`tab-btn ${h==="selections"?"active":""}`,onClick:()=>d("selections"),children:"Mes Sélections"})]}),e.jsx("div",{className:"tab-content animate-fadeInUp",children:M()})]})})};export{E as default};
